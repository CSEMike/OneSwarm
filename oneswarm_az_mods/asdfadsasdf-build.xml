<?xml version="1.0" encoding="utf-8" ?>
<project name="oneswarm_az_mods" default="jar" basedir=".">
	<taskdef resource="net/sf/antcontrib/antlib.xml" />

	<description>
    oneswarm_gwt_ui build file. 
  </description>

	<!-- Build the azurues mods jar -->
	<!-- azureus mods properties -->
	<property name="az_mods_project" value="." />
	<property name="az_mods_az_bugfixes.dir" value="${az_mods_project}/mods_az_bugfixes" />
	<property name="az_mods_plugins.dir" value="${az_mods_project}/mods_plugins" />
	<property name="az_mods_f2f_src.dir" value="${az_mods_project}/mods_f2f" /> 
	<property name="az_mods_onehop_src.dir" value="${az_mods_project}/mods_onehop" />
	<property name="az_mods_swt_src.dir" value="${az_mods_project}/mods_swt" />
	<property name="az_mods_autoupdate_src.dir" value="${az_mods_project}/mods_autoupdate" />
	<property name="az_mods_constants_src.dir" value="${az_mods_project}/mods_constants" />
	<property name="az_mods_gwt_ui_src.dir" value="${az_mods_project}/mods_gwt_ui" />
	<property name="az_mods_bin.dir" value="${az_mods_project}/bin" />
	<property name="az_jar.dir" value="${az_mods_project}/../oneswarm_build/build/lib/" />
	<property name="az_mods_deploy.dir" value="${az_mods_project}/deploy" />
	<property name="az_mods_deploy.jar" value="${az_mods_deploy.dir}/OneSwarmAzMods.jar" />

	<!-- set classpath -->
	<path id="az_mods.class.path">
		<pathelement path="${az_jar.dir}/Azureus2.jar" />
	</path>

	<target name="compile" description="compile az modification code">
		<mkdir dir="${az_mods_bin.dir}" />
		<!-- compile the azureus mods -->
		<javac srcdir="${az_mods_plugins.dir}:${az_mods_az_bugfixes.dir}:${az_mods_f2f_src.dir}:${az_mods_autoupdate_src.dir}:${az_mods_swt_src.dir}:${az_mods_onehop_src.dir}:${az_mods_constants_src.dir}:${az_mods_gwt_ui_src.dir}" destdir="${az_mods_bin.dir}" nowarn="yes" source="1.5" target="1.5" includeAntRuntime="no" debug="true" debuglevel="lines,vars,source" fork="yes" memoryMaximumSize="256m">
			<!--<javac srcdir="${az_mods_f2f_src.dir}:${az_mods_autoupdate_src.dir}:${az_mods_swt_src.dir}:${az_mods_constants_src.dir}:${az_mods_gwt_ui_src.dir}" destdir="${az_mods_bin.dir}" nowarn="yes" source="1.5" target="1.5" includeAntRuntime="no" debug="true" debuglevel="lines,vars,source" fork="yes" memoryMaximumSize="256m">-->
			<classpath refid="az_mods.class.path" />
		</javac>

	</target>

	<target name="jar" depends="compile" description="Create the jar">
		<mkdir dir="${az_mods_deploy.dir}" />
		<jar destfile="${az_mods_deploy.jar}">
			<fileset dir="${az_mods_bin.dir}">
				<include name="**/*.class" />
				<include name="**/*.png" />
				<include name="**/*.jpg" />
			</fileset>
			<!-- Get the properties files -->
			<fileset file="${az_mods_project}/OneSwarmAzMods.properties" />
			<fileset file="${az_mods_project}/mods_constants/org/gudy/azureus2/internat/MessagesBundle.properties" />
		</jar>
	</target>

	<target name="clean">
		<!-- Delete the bin directory tree -->
		<delete failonerror="false">
			<fileset dir="bin" includes="**/*.class" />
		</delete>
	</target>

	<target name="version" description="it updates the build version">
		<!-- update the version -->
		<propertyfile file="${az_mods_project}/OneSwarmAzMods.properties" comment="Build version info">
			<entry key="OS_AZ_MODS_MINOR_VERSION" default="0" type="int" operation="+" value="1" pattern="0" />
		</propertyfile>
		<property file="${az_mods_project}/OneSwarmAzMods.properties" />
		<propertyfile file="${az_mods_project}/OneSwarmAzMods.properties" comment="Build version info">
			<entry key="OS_AZ_MODS_VERSION" value="${OS_AZ_MODS_MAJOR_VERSION}.${OS_AZ_MODS_MINOR_VERSION}" />
		</propertyfile>
	</target>

	<target name="deploy" depends="version,jar" description="this is called from the deploy script, it first updates the version, then packs the jar and signs it">

		<!-- pack the file -->
		<exec executable="pack200">
			<arg value="--repack" />
			<arg value="${az_mods_deploy.jar}" />
		</exec>

	</target>

</project>
